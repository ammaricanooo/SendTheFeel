<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Send The Feel</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,200..800;1,200..800&family=Reenie+Beanie&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/style.css">
</head>

<body>
    <header
        class="sticky z-10 top-0 left-0 w-full px-4 py-4 flex items-center justify-center bg-white border-b border-gray-300">
        <div class="flex items-center justify-between w-full max-w-6xl">
            <div>
                <p class="text-xl lg:text-2xl font-hand">stf</p>
            </div>
            <div class="flex flex-row items-center space-x-5">
                <a href="/submit" class="text-sm text-gray-950">Submit</a>
                <a href="/browse" class="text-sm text-gray-950">Browse</a>
                <a href="/history" class="text-sm text-gray-950 underline">History</a>
                <a href="/support" class="text-sm text-gray-950">Support</a>
            </div>
        </div>
    </header>
    <main class="w-full max-w-6xl space-y-5 mx-auto pt-4 pb-8 sm:pt-8 sm:pb-11 px-4">
        <div class="flex flex-col max-w-3xl w-full mx-auto">
            <p
                class="mb-4 font-[600] text-[32px] leading-[36px] tracking-[-0.025em] text-gray-950 sm:mb-5 sm:text-[48px] sm:leading-[48px]">
                History</p>
            <p
                class="mb-6 font-[400] text-[14px] leading-[22px] tracking-[-0.005em] text-gray-700 sm:mb-7 sm:text-[16px] sm:leading-[26px]">
                These are links to your previously submitted messages. They're stored locally and will be automatically
                deleted after 30 days.</p>
            <div class="px-4 py-6 relative border border-[#E9E9E9] w-full bg-gray-50">
                <div id="history-list" class="grid grid-cols-1 place-items-center gap-x-10 gap-y-4 w-fit mx-auto">
                </div>
                <div class="absolute inset-0 pointer-events-none"><svg xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 24 24" fill="none" stroke-linecap="round" stroke-linejoin="round" width="24"
                        height="24" stroke="currentColor" stroke-width="2"
                        class="lucide lucide-icon lucide-plus absolute stroke-1 -top-3 -inset-x-3">
                        <path d="M5 12h14" key="1ays0h"></path>
                        <path d="M12 5v14" key="s699le"></path>
                    </svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round"
                        stroke-linejoin="round" width="24" height="24" stroke="currentColor" stroke-width="2"
                        class="lucide lucide-icon lucide-plus absolute stroke-1 -top-3 -right-3">
                        <path d="M5 12h14" key="1ays0h"></path>
                        <path d="M12 5v14" key="s699le"></path>
                    </svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round"
                        stroke-linejoin="round" width="24" height="24" stroke="currentColor" stroke-width="2"
                        class="lucide lucide-icon lucide-plus absolute stroke-1 -bottom-3 -inset-x-3">
                        <path d="M5 12h14" key="1ays0h"></path>
                        <path d="M12 5v14" key="s699le"></path>
                    </svg><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke-linecap="round"
                        stroke-linejoin="round" width="24" height="24" stroke="currentColor" stroke-width="2"
                        class="lucide lucide-icon lucide-plus absolute stroke-1 -bottom-3 -right-3">
                        <path d="M5 12h14" key="1ays0h"></path>
                        <path d="M12 5v14" key="s699le"></path>
                    </svg></div>
            </div>
        </div>
        <div style="position: fixed; z-index: 9999; inset: 16px; pointer-events: none;">
            <style>
                .sldt-active {
                    z-index: 9999;
                }

                .sldt-active>* {
                    pointer-events: auto;
                }
            </style>
        </div>
    </main>
    <div class="mt-auto">
        <div class="mx-auto py-8 border-t border-[#D9D9D9] sm:px-6">
            <div class="flex flex-col items-center justify-center space-y-4">
                <div class="flex space-x-6"><a class="text-xs text-gray-950 hover:underline sm:text-sm" target="_blank"
                        rel="noopener noreferrer" href="https://www.instagram.com/ammaricano">Instagram</a>
                    <a class="text-xs text-gray-950 hover:underline sm:text-sm" target="_blank"
                        rel="noopener noreferrer" href="https://wa.me/62895702633030">Send Feedback</a>
                    <a href="/support" class="text-xs text-gray-950 hover:underline sm:text-sm inactive"
                        link="">Support</a>
                </div>
                <div class="text-[10px] text-gray-950 sm:text-xs">Â© ammaricano. All Rights Reserved.</div>
            </div>
        </div>
    </div>
    <% if (slug) { %>
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const params = new URLSearchParams(window.location.search);
                const slug = params.get('slug');
                if (slug) {
                    const url = `${window.location.origin}/details/${slug}`;
                    let history = JSON.parse(localStorage.getItem('sts_history') || '[]');
                    if (!history.some(item => item.url === url)) {
                        history.unshift({ url, date: Date.now() });
                        localStorage.setItem('sts_history', JSON.stringify(history));
                    }
                }
            });
        </script>
        <% } %>
            <script>
                document.addEventListener('DOMContentLoaded', () => {
                    let history = JSON.parse(localStorage.getItem('sts_history') || '[]');
                    const THIRTY_DAYS = 30 * 24 * 60 * 60 * 1000;
                    const now = Date.now();
                    history = history.filter(item => now - item.date < THIRTY_DAYS);
                    localStorage.setItem('sts_history', JSON.stringify(history));

                    const list = document.getElementById('history-list');
                    if (history.length === 0) {
                        list.innerHTML = `<div class="col-span-full text-center py-8">
                <img src="/NotFound.png" alt="No histories found" class="w-full max-w-96 mx-auto mb-4">
                <h3 class="text-xl font-semibold text-gray-900 mb-2">No Histories Found</h3>
                <p class="text-gray-600">Looks like there's no history yet! Start by sending your message <a href="/submit" class="font-bold underline">here</a>.</p>
            </div>`;
                    } else {
                        history.forEach(item => {
                            const div = document.createElement('div');
                            div.className = "flex items-center justify-between gap-6 w-full";
                            div.innerHTML = `<a
                    href="${item.url}"
                    class="font-[400] overflow-hidden underline text-sm truncate inactive"
                    link="">${item.url}</a>
                    <button
                        type="button"
                        class="copy-btn cursor-pointer inline-flex items-center justify-center gap-2 font-medium text-sm whitespace-nowrap transition-all text-[#FFFFFF] bg-[#171717] shrink-0 w-fit h-auto rounded-lg p-2"
                        data-url="${item.url}">
                        <svg
                            xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                            stroke-linecap="round" stroke-linejoin="round" width="14" height="14"
                            stroke="currentColor" stroke-width="2" class="lucide lucide-icon lucide-copy">
                            <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                            <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                        </svg>
                    </button>`;
                            list.appendChild(div);
                        });
                        list.addEventListener('click', function (e) {
                            if (e.target.closest('.copy-btn')) {
                                const btn = e.target.closest('.copy-btn');
                                const urlToCopy = btn.getAttribute('data-url');
                                navigator.clipboard.writeText(urlToCopy).then(() => {
                                    btn.innerHTML = '<p class="text-xs">Copied!</p>';
                                    setTimeout(() => {
                                        btn.innerHTML = `<svg
                                xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"
                                stroke-linecap="round" stroke-linejoin="round" width="14" height="14"
                                stroke="currentColor" stroke-width="2" class="lucide lucide-icon lucide-copy">
                                <rect width="14" height="14" x="8" y="8" rx="2" ry="2"></rect>
                                <path d="M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2"></path>
                            </svg>`;
                                    }, 1200);
                                });
                            }
                        });
                    }
                    const url = new URL(window.location.href);
                    url.searchParams.delete('slug');
                    window.history.replaceState({}, document.title, url.pathname);
                });
            </script>
</body>

</html>
